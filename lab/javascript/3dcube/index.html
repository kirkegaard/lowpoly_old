<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>canvas demo</title>

    <style type="text/css" media="screen">
        body {
            margin: 0;
            overflow:hidden;
            background-color: #fff;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script type="text/javascript" charset="utf-8">
        (function() {

            var SCREEN_WIDTH  = window.innerWidth
              , SCREEN_HEIGHT = window.innerHeight
              , canvas        = document.getElementById('canvas')
              , context       = canvas.getContext('2d')
              , cid           = context.getImageData(0, 0, SCREEN_WIDTH, SCREEN_WIDTH)
              , vertices      = []
              , count         = 1
              , now           = 0;

            init();

            function rnd() {
                return Math.random() * 128-64;
            }

            function init() {
                canvas.height = SCREEN_HEIGHT;
                canvas.width  = SCREEN_WIDTH;

                for(var i=50000; i--;) {
                    vertices.push({
                        x: rnd(),
                        y: rnd(),
                        z: rnd()
                    });
                }

                render();
            }

            function render() {
                now = now + 0.002;

                var frame   = now * 2 * Math.PI
                  , a       = Math.sin(frame*1.1)*3
                  , b       = Math.cos(frame*1.3)*2
                  , aInc    = Math.PI
                  , bInc    = Math.PI

                  , mask    = 2147483644

                  , zClip   = 1024
                  , yClip   = SCREEN_HEIGHT * 4
                  , xClip   = SCREEN_WIDTH * 4
                  , xOffset = (SCREEN_WIDTH * 2) + (Math.cos(frame) * (SCREEN_WIDTH / 2))
                  , yOffset = (SCREEN_HEIGHT * 2) + (Math.sin(frame) * (SCREEN_HEIGHT / 2))
                  , zOffset = 192 - (32 * Math.cos(frame * 4));

                for(var i = SCREEN_WIDTH * SCREEN_HEIGHT, j = 3; i--; j+=4) {
                    cid.data[j]=0;
                }

                for(var j = count; j--;) {
                    var sa = Math.sin(a)
                      , ca = Math.cos(a)
                      , sb = Math.sin(b)
                      , cb = Math.cos(b);

                    for(var i = 0, v; v = vertices[i]; i++) {
                        var x  = v.x
                          , y  = v.y
                          , z  = v.z

                          , t  = y * sa + z * ca
                          , zr = x * sb + t * cb + zOffset;

                        if(zr > 1){
                            var p  = zClip / zr
                              , yr = (yOffset + p * (y * ca - z * sa)) & mask;

                            if(yr < yClip) {
                                var xr = (xOffset + p * (x * cb - t * sb)) & mask;

                                if( xr < xClip ) {
                                    cid.data[(xr + yr * SCREEN_WIDTH) | 3] = 230;
                                }
                            }
                        }
                    }

                    a += aInc;
                    b -= bInc;
                }

                context.putImageData(cid, 0, 0);
                setTimeout(render, 10);
            }

        })();
    </script>
</body>
</html>
